# 推荐模块说明文档

## 整体说明

推荐模块由两个代码文件与多个中间数据文件组成

其中`recommend.py`			负责中间数据文件的检测与生成；案情的推荐；数据的更新

​	 `information_gain.py`  负责计算信息增益，从而得出特征词

多个中间数据文件保证在接线员推荐过程中能够有着更加快速的反馈

## recommend.py

### get_equal_rate

#### 功能

求出两个字符串的忽略中文逗号的莱文斯坦（Levenshtein）比

#### 输入输出

| 输入/输出 | 变量名 | 类型   | 说明                         |
| --------- | ------ | ------ | ---------------------------- |
| input     | str1   | string | 需要比较相似度的第一个字符串 |
| input     | str2   | string | 需要比较相似度的第二个字符串 |
| output    | none   | double | 两个字符串的莱文斯坦比       |





### combine_collection

#### 功能

根据两组行动序列的相似度合并成一组行动序列

#### 输入输出

| 输入/输出 | 变量名        | 类型          | 说明                     |
| --------- | ------------- | ------------- | ------------------------ |
| input     | array1        | array[string] | 需要合并的第一组行动序列 |
| input     | array2        | array[string] | 需要合并的第二组行动序列 |
| output    | combine_array | array[string] | 两组合并之后得到的序列   |

## 

### save_statistical

#### 功能

存储计算过程中的中间数据

#### 输入输出

| 输入/输出 | 变量名           | 类型   | 说明                 |
| --------- | ---------------- | ------ | -------------------- |
| input     | statistical_path | string | 需要存储数据的路径   |
| input     | data             | object | 需要存储的数据       |
| output    | none             | file   | 存储数据的二进制文件 |



### load_statistical

#### 功能

读取计算过程中的中间数据

#### 输入输出

| 输入/输出 | 变量名           | 类型   | 说明           |
| --------- | ---------------- | ------ | -------------- |
| input     | statistical_path | string | 存储数据的路径 |
| output    | data             | object | 读取到的数据   |



### satisfaction

#### 功能

由用户判断是否需要进行相似度匹配

#### 输入输出

| 输入输出 | 变量名 | 类型    | 说明           |
| -------- | ------ | ------- | -------------- |
| output   | none   | boolean | 用户判断的结果 |



### init_label

#### 功能

读取案情文件，对行动序列进行聚类，存储相似度匹配的相关数据

#### 输入输出

| 输入/输出 | 变量名           | 类型   | 说明                                 |
| --------- | ---------------- | ------ | ------------------------------------ |
| input     | data_path        | string | 案情数据的存放目录                   |
| input     | statistical_path | string | 案情标签——案情解决方法的字典存放路径 |
| input     | collection_path  | string | 案情标签——案情行动序列的字典存放路径 |
| input     | ig_value_path    | string | 信息增益得出的特征词存放路径         |
| input     | near_words_path  | string | 腾讯近义词库存放路径                 |



### get_near_words

#### 功能

得到特征词的近义词词典，为之后的相似度比较做准备

#### 输入输出

| 输入/输出 | 变量名         | 类型       | 说明                 |
| --------- | -------------- | ---------- | -------------------- |
| input     | ig_words       | array      | 信息增益得出的特征词 |
| input     | near_data_path | string     | 腾讯近义词库存放路径 |
| output    | near_data_dic  | dictionary | 近义词—>原词的字典   |



### search_solution

#### 功能

与接线员进行交互，推荐输入案情的相似度最高的三件案情和对应的行动序列

#### 输入输出

| 输入/输出 | 变量名           | 类型   | 说明                                 |
| --------- | ---------------- | ------ | ------------------------------------ |
| input     | data_path        | string | 案情数据的存放目录                   |
| input     | labels_data_path | string | 案情标签——案情解决方法的字典存放路径 |
| input     | statistical_path | string | 案情标签——案情行动序列的字典存放路径 |
| input     | ig_value_path    | string | 信息增益得出的特征词存放路径         |
| input     | near_words_path  | string | 腾讯近义词库存放路径                 |
| input     | case             | array  | 输入的案情信息以及预测的案情标签     |



### text2word

#### 功能

通过`jieba`进行分词，与特征词语及其近义词进行比对，得到案情所切分成的词语序列

#### 输入输出

| 输入/输出 | 变量名     | 类型       | 说明                           |
| --------- | ---------- | ---------- | ------------------------------ |
| input     | text       | string     | 输入的案情                     |
| input     | words      | array      | 特征词语                       |
| input     | near_words | dictionary | key：近义词—>value：原词的词典 |
| output    | result     | array      | 案情中特征词的词语序列         |



### IG_search_solution

#### 功能

通过案情种特征词形成的词语序列得到TF-IDF矩阵，并用新输入案情的向量与数据中的其他案情进行比对，得到与输入案情最相近的三件案情和他们的解决方案。

#### 输入输出

| 输入/输出 | 变量名           | 类型   | 说明                                                         |
| --------- | ---------------- | ------ | ------------------------------------------------------------ |
| input     | labels_data_path | string | 案情标签——案情解决方法的字典存放路径                         |
| input     | ig_value_path    | string | 信息增益得出的特征词存放路径                                 |
| input     | near_words_path  | string | 腾讯近义词库存放路径                                         |
| input     | case             | array  | 输入的案情信息及其预测的案情标签                             |
| output    | solution         | array  | solution中是一个具有三个元素的数组，每个元素包括[0]案情信息，[1]相似度，[2]案情的处理方法 |

## 

### update

#### 功能

将输入的案情，案情标签以及选取的处理方案添加到数据文件中

#### 输入输出

| 输入/输出 | 变量名           | 类型   | 说明                                 |
| --------- | ---------------- | ------ | ------------------------------------ |
| input     | labels_data_path | string | 案情标签——案情解决方案的字典存放路径 |
| input     | statistical_path | string | 案情标签——案情行动序列的字典存放路径 |
| input     | case             | array  | 输入的案情信息及其预测的案情标签     |
|           | selection        | string | 接线员选择的解决方案                 |



### main

#### 功能

传入case参数，对相应的文件路径进行赋值，调用相关函数

#### 输入输出

| 输入/输出 | 变量名 | 类型  | 说明                             |
| --------- | ------ | ----- | -------------------------------- |
| input     | case   | array | 输入的案情信息及其预测的案情标签 |



## information_gain.py

### stop_words

#### 功能

读取停用词并将其变成数组

#### 输入输出

| 输入/输出 | 变量名 | 类型   | 说明               |
| --------- | ------ | ------ | ------------------ |
| input     | path   | string | 停用词库的存放地址 |



### is_all_zh

#### 功能

判断词语是否均为中文

#### 输入输出

| 输入/输出 | 变量名 | 类型    | 说明                         |
| --------- | ------ | ------- | ---------------------------- |
| input     | s      | string  | jieba分词所得词语            |
| output    | none   | boolean | 返回是否词语全是中文的布尔值 |



### is_all_useful

#### 功能

判断词语的词性是否符合需求

#### 输入输出

| 输入/输出 | 变量名 | 类型    | 说明                     |
| --------- | ------ | ------- | ------------------------ |
| input     | flat   | boolean | jieba分词所得词语词性    |
| output    | none   | boolean | 返回是否词语词性符合标准 |



### get_TF

#### 功能

根据词频获取排名TopK的词语

#### 输入输出

| 输入/输出 | 变量名 | 类型  | 说明                             |
| --------- | ------ | ----- | -------------------------------- |
| input     | words  | array | jieba分词筛选过后的全部词语      |
| input     | topK   | int   | 选取的词频数目                   |
| output    | none   | list  | 由词频从高到低排序的前TopK个词语 |



### get_infGain

#### 功能

计算词语的信息增益值，并进行排序与选择

#### 输入输出

| 输入/输出 | 变量名               | 类型   | 说明                                 |
| --------- | -------------------- | ------ | ------------------------------------ |
| input     | words                | list   | 需要计算信息增益的词语，由get_TF得出 |
| input     | corpus               | array  | 全体案情信息                         |
| input     | types_ratio          | double | 每类标签在全体案情信息中所占比例     |
| input     | words_ratio          | double | 每个词语在全体案情信息中所占比例     |
| input     | types_words_ratio    | double | 案情是某类标签且存在某词语的概率     |
| input     | types_nonwords_ratio | double | 案情是某类标签且不存在某词语的概率   |



### IG_prepare

#### 功能

进行前期的分词，筛选，计算等准备工作，调用函数获取特征词

#### 输入输出

| 输入/输出 | 变量名 | 类型      | 说明               |
| --------- | ------ | --------- | ------------------ |
| input     | data   | dataframe | 案情文件中的案情列 |
| input     | labels | dataframe | 案情文件中的标签列 |
| output    | none   | list      | 信息增益所获特征词 |

